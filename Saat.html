<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Canlı Saat</title>
    <style>
        :root {
            --bg-dark: #080808;
            --sidebar-bg: #121212;
            --accent-green: #2ea043;
            --accent-blue: #2f81f7;
            --text-main: #ffffff;
            --text-dim: #888888;
            --danger: #da3633;
            --border: #252525;
            --card-bg: #1a1a1a;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Inter', -apple-system, sans-serif; }
        body { background-color: var(--bg-dark); color: var(--text-main); display: flex; height: 100vh; overflow: hidden; transition: background-color 0.5s ease; }

        /* --- SIDEBAR --- */
        aside {
            width: 280px; background: var(--sidebar-bg); border-right: 1px solid var(--border);
            display: flex; flex-direction: column; padding: 20px 0; flex-shrink: 0; overflow-y: auto;
        }
        .nav-group { margin-bottom: 25px; }
        .nav-title { padding: 0 20px; font-size: 0.7rem; color: var(--text-dim); text-transform: uppercase; letter-spacing: 1.2px; margin-bottom: 10px; }
        .nav-item {
            padding: 12px 20px; cursor: pointer; transition: 0.2s; display: flex; align-items: center;
            font-size: 0.9rem; color: var(--text-main); border-left: 3px solid transparent;
        }
        .nav-item:hover { background: rgba(255,255,255,0.05); }
        .nav-item.active { background: #1a1a1a; color: var(--accent-blue); border-left-color: var(--accent-blue); }

        /* --- MAIN CONTENT --- */
        main { 
            flex: 1; 
            padding: 40px; 
            overflow-y: auto; 
            display: flex; 
            flex-direction: column; 
            align-items: center; 
            justify-content: center; 
            position: relative; 
        }
        .content-section { display: none; width: 100%; max-width: 1100px; animation: fadeIn 0.3s ease; text-align: center; }
        .content-section.active { display: flex; flex-direction: column; align-items: center; justify-content: center; width: 100%; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        /* Dil Seçici */
        .lang-switcher { position: absolute; top: 20px; right: 20px; display: flex; gap: 8px; z-index: 100; }
        .lang-btn { background: var(--card-bg); border: 1px solid var(--border); color: white; padding: 5px 12px; border-radius: 10px; cursor: pointer; font-size: 0.8rem; }
        .lang-btn:hover { border-color: var(--accent-blue); }

        /* --- ANALOG SAAT --- */
        .clock-circle {
            width: 320px; height: 320px; border: 8px solid var(--text-main); border-radius: 50%;
            margin-bottom: 30px; position: relative; background: radial-gradient(circle, #111 0%, #000 100%); 
            box-shadow: 0 0 50px rgba(0,0,0,0.8), inset 0 0 20px rgba(255,255,255,0.05);
        }
        .hand { position: absolute; bottom: 50%; left: 50%; transform-origin: bottom; background: var(--text-main); border-radius: 10px; z-index: 10; }
        .hour { width: 8px; height: 22%; margin-left: -4px; }
        .minute { width: 5px; height: 35%; margin-left: -2.5px; }
        .second { width: 2px; height: 42%; margin-left: -1px; background: var(--danger); transition: none; border-radius: 0; }
        .center-dot { position: absolute; top: 50%; left: 50%; width: 16px; height: 16px; background: var(--text-main); border-radius: 50%; transform: translate(-50%, -50%); z-index: 15; border: 3px solid #000; }
        
        .clock-number {
            position: absolute; width: 40px; height: 40px; text-align: center; line-height: 40px;
            font-weight: 800; font-size: 1.4rem; color: var(--text-main); transform: translate(-50%, -50%); z-index: 5;
        }

        .mark { position: absolute; width: 100%; height: 100%; text-align: center; pointer-events: none; }
        .mark::after { content: ''; display: inline-block; background: var(--text-dim); width: 2px; height: 10px; }
        .mark-large::after { width: 5px; height: 20px; background: var(--accent-blue); box-shadow: 0 0 10px var(--accent-blue); }

        /* --- UI ELEMENTS --- */
        .digital-big { font-size: 5.5rem; font-weight: 200; font-variant-numeric: tabular-nums; letter-spacing: -3px; font-family: monospace; margin-bottom: 5px; }
        
        /* --- YAMUK ÖNEMLİ OLAY KUTUSU --- */
        .info-box { 
            background: var(--card-bg); 
            padding: 30px; 
            border-radius: 24px; 
            margin-top: 40px; 
            border: 2px solid var(--accent-blue); 
            max-width: 650px; 
            transform: rotate(-2.5deg); 
            box-shadow: 15px 15px 0px rgba(47, 129, 247, 0.15);
            transition: 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            cursor: pointer;
        }
        .info-box:hover { transform: rotate(0deg) scale(1.02); box-shadow: 5px 5px 20px rgba(47, 129, 247, 0.3); }
        .info-box h2 { font-size: 1.5rem; margin-bottom: 12px; color: var(--accent-blue); font-weight: 700; }
        .info-box p { font-size: 1.1rem; line-height: 1.6; }

        .btn { border: none; padding: 14px 40px; border-radius: 50px; cursor: pointer; font-size: 1rem; font-weight: bold; transition: 0.2s; margin: 8px; text-transform: uppercase; }
        .btn-green { background: var(--accent-green); color: white; }
        .btn-red { background: var(--danger); color: white; }

        .world-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(220px, 1fr)); gap: 15px; margin-top: 20px; width: 100%; }
        .city-card { background: var(--card-bg); padding: 20px; border-radius: 12px; border: 1px solid var(--border); text-align: left; transition: 0.2s; cursor: pointer; }

        /* --- COUNTERS --- */
        .timer-grid { display: flex; flex-wrap: wrap; gap: 15px; margin-top: 30px; justify-content: center; width: 100%; max-width: 800px; }
        .unit-card { background: #1a1a1a; padding: 20px; border-radius: 15px; border: 1px solid #333; min-width: 140px; flex: 1 1 140px; max-width: 180px; text-align: center; box-shadow: 0 4px 15px rgba(0,0,0,0.4); }
        .u-val { display: block; font-size: 2.2rem; font-weight: bold; color: var(--accent-blue); font-family: monospace; }
        .u-lab { font-size: 0.75rem; color: var(--text-dim); text-transform: uppercase; margin-top: 5px; display: block; letter-spacing: 1px; }

        .timer-inputs { display: flex; gap: 10px; justify-content: center; margin-bottom: 25px; }
        .t-field { width: 75px; background: #111; border: 1px solid #444; color: white; padding: 14px; border-radius: 12px; text-align: center; font-size: 1.3rem; }

        input { background: #111; border: 1px solid #444; color: white; padding: 14px 24px; border-radius: 14px; margin: 10px; outline: none; transition: border-color 0.2s; }
        input:focus { border-color: var(--accent-blue); }
    </style>
</head>
<body>

    <div class="lang-switcher">
        <button class="lang-btn" onclick="changeLang('tr')">TR</button>
        <button class="lang-btn" onclick="changeLang('en')">EN</button>
        <button class="lang-btn" onclick="changeLang('de')">DE</button>
    </div>

    <aside>
        <div class="nav-group">
            <div class="nav-title" data-key="title-panel">Zaman Paneli</div>
            <div class="nav-item active" onclick="showTab(this, 'clock-sec')" data-key="menu-clock">Canlı Saat</div>
            <div class="nav-item" onclick="showTab(this, 'chrono-sec')" data-key="menu-chrono">Kronometre</div>
            <div class="nav-item" onclick="showTab(this, 'timer-sec')" data-key="menu-timer">Zamanlayıcı</div>
            <div class="nav-item" onclick="showTab(this, 'world-sec')" data-key="menu-world">Dünya Saatleri</div>
        </div>
        <div class="nav-group">
            <div class="nav-title" data-key="title-counters">Sayaçlar</div>
            <div class="nav-item" onclick="showTab(this, 'lgs-sec')">LGS 2026</div>
            <div class="nav-item" onclick="showTab(this, 'yks-sec')">YKS 2026</div>
            <div class="nav-item" onclick="showTab(this, 'school-sec')" data-key="menu-school">Okul Kapanış</div>
            <div class="nav-item" onclick="showTab(this, 'eid-sec')" data-key="menu-eid">Kurban Bayramı</div>
            <div class="nav-item" onclick="showTab(this, 'newyear-sec')" data-key="menu-newyear">Yılbaşı</div>
            <div class="nav-item" onclick="showTab(this, 'halloween-sec')">Halloween</div>
        </div>
        <div class="nav-group">
            <div class="nav-title" data-key="title-calc">Hesaplayıcılar</div>
            <div class="nav-item" onclick="showTab(this, 'age-sec')" data-key="menu-age">Yaş (Detaylı)</div>
            <div class="nav-item" onclick="showTab(this, 'diff-sec')" data-key="menu-diff">Tarih Farkı</div>
        </div>
    </aside>

    <main>
        <!-- CANLI SAAT VE OLAYLAR -->
        <section id="clock-sec" class="content-section active">
            <div class="clock-circle" id="analog">
                <div class="center-dot"></div>
                <div class="hand hour" id="h-hand"></div>
                <div class="hand minute" id="m-hand"></div>
                <div class="hand second" id="s-hand"></div>
            </div>
            <div class="digital-big" id="d-time">00:00:00</div>
            <div id="utc-label" style="color: var(--accent-blue); font-weight: bold; letter-spacing: 2px; font-size: 1.1rem;">İSTANBUL | UTC+3</div>
            
            <div class="info-box" id="fact-box">
                <h2 id="full-date">Yükleniyor...</h2>
                <p id="fact">Olaylar Wikipedia'dan getiriliyor...</p>
            </div>
        </section>

        <!-- ARAÇLAR -->
        <section id="chrono-sec" class="content-section">
            <h1 data-key="menu-chrono">Kronometre</h1>
            <div class="digital-big" style="font-size: 5rem; margin: 40px 0;" id="ch-disp">00:00:00:00</div>
            <button id="ch-toggle" class="btn btn-green" onclick="toggleChrono()" data-key="btn-start">BAŞLAT</button>
            <button class="btn btn-red" onclick="resetChrono()" data-key="btn-reset">SIFIRLA</button>
        </section>

        <section id="timer-sec" class="content-section">
            <h1 data-key="menu-timer">Zamanlayıcı</h1>
            <div class="timer-inputs" id="tm-fields">
                <input type="number" id="tm-d" class="t-field" placeholder="G" min="0">
                <input type="number" id="tm-h" class="t-field" placeholder="S" min="0" max="23">
                <input type="number" id="tm-m" class="t-field" placeholder="D" min="0" max="59">
                <input type="number" id="tm-s" class="t-field" placeholder="SN" min="0" max="59">
            </div>
            <div class="digital-big" id="tm-disp" style="display:none; font-size: 5rem; margin: 40px 0;">0:00:00:00</div>
            <button id="tm-toggle" class="btn btn-green" onclick="toggleTimer()" data-key="btn-start">BAŞLAT</button>
            <button class="btn btn-red" onclick="resetTimer()" data-key="btn-reset">SIFIRLA</button>
        </section>

        <!-- DÜNYA SAATLERİ -->
        <section id="world-sec" class="content-section">
            <h1 data-key="menu-world">Dünya Saatleri</h1>
            <input type="text" id="city-search" placeholder="Şehir Ara..." style="width:100%; max-width:600px; margin-bottom:20px;" oninput="filterCities()">
            <div class="world-grid" id="world-grid"></div>
        </section>

        <!-- GERİ SAYIMLAR -->
        <section id="lgs-sec" class="content-section cd-sec" data-type="fixed" data-date="June 7, 2026 09:30:00"><h1>LGS 2026</h1><div class="timer-grid"></div></section>
        <section id="yks-sec" class="content-section cd-sec" data-type="fixed" data-date="June 14, 2026 10:15:00"><h1>YKS 2026</h1><div class="timer-grid"></div></section>
        
        <section id="school-sec" class="content-section cd-sec" data-type="fixed" data-date="June 19, 2026 17:00:00">
            <h1 data-key="menu-school">Okul Kapanış</h1>
            <div class="timer-grid"></div>
        </section>

        <section id="eid-sec" class="content-section cd-sec" data-type="eid">
            <h1 id="eid-title">Kurban Bayramı</h1>
            <div class="timer-grid"></div>
        </section>
        
        <section id="newyear-sec" class="content-section cd-sec" data-type="yearly" data-month="0" data-day="1">
            <h1 id="ny-title">Yılbaşı</h1>
            <div class="timer-grid"></div>
        </section>
        
        <section id="halloween-sec" class="content-section cd-sec" data-type="yearly" data-month="9" data-day="31">
            <h1 id="hw-title">Halloween</h1>
            <div class="timer-grid"></div>
        </section>
        
        <!-- HESAPLAYICILAR -->
        <section id="age-sec" class="content-section">
            <h1 data-key="menu-age">Yaş (Detaylı)</h1>
            <input type="datetime-local" id="birth-input">
            <button class="btn btn-green" onclick="startAge()" data-key="btn-calc">HESAPLA</button>
            <div id="age-res" class="timer-grid" style="margin-top:30px; display:none;"></div>
        </section>

        <section id="diff-sec" class="content-section">
            <h1 data-key="menu-diff">Tarih Farkı</h1>
            <div style="margin: 20px 0;">
                <input type="date" id="d1">
                <input type="date" id="d2">
            </div>
            <button class="btn btn-green" onclick="calcD()" data-key="btn-calc">HESAPLA</button>
            <div id="diff-res" class="info-box" style="display:none; margin: 30px auto; transform:none; border-color: var(--accent-green);"></div>
        </section>
    </main>

    <script>
        // --- GLOBAL DEĞİŞKENLER ---
        let mainOffset = 3;
        let mainZone = "İstanbul";
        let lang = 'tr';

        const i18n = {
            tr: {
                "title-panel": "Zaman Paneli", "menu-clock": "Canlı Saat", "menu-chrono": "Kronometre", "menu-timer": "Zamanlayıcı", "menu-world": "Dünya Saatleri",
                "btn-start": "BAŞLAT", "btn-stop": "DURDUR", "btn-reset": "SIFIRLA", "btn-calc": "HESAPLA",
                "menu-eid": "Kurban Bayramı", "menu-newyear": "Yılbaşı", "week": "Hafta", "age": "Yaş (Detaylı)", "diff": "Tarih Farkı",
                "event-label": "Önemli Olay:", "menu-school": "Okul Kapanış"
            },
            en: {
                "title-panel": "Time Panel", "menu-clock": "Live Clock", "menu-chrono": "Stopwatch", "menu-timer": "Timer", "menu-world": "World Clock",
                "btn-start": "START", "btn-stop": "STOP", "btn-reset": "RESET", "btn-calc": "CALCULATE",
                "menu-eid": "Eid al-Adha", "menu-newyear": "New Year", "week": "Week", "age": "Age (Detailed)", "diff": "Date Difference",
                "event-label": "Historical Event:", "menu-school": "School Closing"
            },
            de: {
                "title-panel": "Zeit-Panel", "menu-clock": "Live-Uhr", "menu-chrono": "Stoppuhr", "menu-timer": "Timer", "menu-world": "Weltuhr",
                "btn-start": "START", "btn-stop": "STOPP", "btn-reset": "RESET", "btn-calc": "BERECHNEN",
                "menu-eid": "Opferfest", "menu-newyear": "Neujahr", "week": "Woche", "age": "Alter (Detailliert)", "diff": "Datumsdifferenz",
                "event-label": "Historisches Ereignis:", "menu-school": "Schulabschluss"
            }
        };

        const cities = [
            {n:"Abu Dabi", o:4}, {n:"Addis Ababa", o:3}, {n:"Amman", o:3}, {n:"Amsterdam", o:1}, {n:"Antananarivo", o:3}, {n:"Atina", o:2}, {n:"Auckland", o:13}, {n:"Bangkok", o:7}, {n:"Barselona", o:1}, {n:"Bağdat", o:3}, {n:"Berlin", o:1}, {n:"Beyrut", o:2}, {n:"Bogota", o:-5}, {n:"Boston", o:-5}, {n:"Brüksel", o:1}, {n:"Buenos Aires", o:-3}, {n:"Cakarta", o:7}, {n:"Cape Town", o:2}, {n:"Ciudad de Mexico", o:-6}, {n:"Dakka", o:6}, {n:"Delhi", o:5.5}, {n:"Dubai", o:4}, {n:"Dublin", o:0}, {n:"Frankfurt", o:1}, {n:"Guangzhou", o:8}, {n:"Hanoi", o:7}, {n:"Havana", o:-5}, {n:"Helsinki", o:2}, {n:"Hong Kong", o:8}, {n:"Honolulu", o:-10}, {n:"Kahire", o:2}, {n:"Karakas", o:-4}, {n:"Karaçi", o:5}, {n:"Katmandu", o:5.75}, {n:"Kiev", o:2}, {n:"Kinşasa", o:1}, {n:"Kuala Lumpur", o:8}, {n:"Lagos", o:1}, {n:"Las Vegas", o:-8}, {n:"Lima", o:-5}, {n:"Londra", o:0}, {n:"Los Angeles", o:-8}, {n:"Luanda", o:1}, {n:"Madrid", o:1}, {n:"Manila", o:8}, {n:"Mekke", o:3}, {n:"Miami", o:-5}, {n:"Milano", o:1}, {n:"Moskova", o:3}, {n:"Mumbai", o:5.5}, {n:"New York", o:-5}, {n:"Nuuk", o:-2}, {n:"Osaka", o:9}, {n:"Oslo", o:1}, {n:"Paris", o:1}, {n:"Pekin", o:8}, {n:"Prag", o:1}, {n:"Reykjavik", o:0}, {n:"Rio de Janeiro", o:-3}, {n:"Riyad", o:3}, {n:"Roma", o:1}, {n:"San Francisco", o:-8}, {n:"Sankt Peterburg", o:3}, {n:"Santiago", o:-3}, {n:"Sao Paulo", o:-3}, {n:"Seul", o:9}, {n:"Shenzhen", o:8}, {n:"Sidney", o:11}, {n:"Singapur", o:8}, {n:"Stokolm", o:1}, {n:"Tahran", o:3.5}, {n:"Taipei", o:8}, {n:"Tel Aviv", o:2}, {n:"Tokyo", o:9}, {n:"Toronto", o:-5}, {n:"Vancouver", o:-8}, {n:"Varşova", o:1}, {n:"Viyana", o:1}, {n:"Washington, D.C.", o:-5}, {n:"Yangon", o:6.5}, {n:"İstanbul", o:3}, {n:"Şam", o:3}, {n:"Şangay", o:8}, {n:"Şikago", o:-6},
            {n:"UTC", o:0}, {n:"GMT", o:0}, {n:"CET", o:1}, {n:"Pacific Time", o:-8}, {n:"Mountain Time", o:-7}, {n:"Central Time", o:-6}, {n:"Eastern Time", o:-5}, {n:"China Standard Time", o:8}, {n:"India Standard Time", o:5.5}
        ];

        const eidDates = ["2026-05-27", "2027-05-16", "2028-05-04", "2029-04-24", "2030-04-14"];

        // --- WIKIPEDIA OLAY API ---
        async function fetchDailyFact() {
            const now = new Date();
            const month = (now.getMonth() + 1).toString().padStart(2, '0');
            const day = now.getDate().toString().padStart(2, '0');
            
            if (month === "01" && day === "03") {
                document.getElementById('fact').innerText = (lang === 'tr') ? 
                    "Önemli Olay: Bugün 3 Ocak. 2009'da Bitcoin'in ilk bloğu (Genesis Block) kazıldı." :
                    "Historical Event: Today is Jan 3rd. In 2009, the Bitcoin Genesis Block was mined.";
                return;
            }

            try {
                const response = await fetch(`https://en.wikipedia.org/api/rest_v1/feed/onthisday/events/${month}/${day}`);
                const data = await response.json();
                
                if (data.events && data.events.length > 0) {
                    const event = data.events[data.events.length - 1];
                    const label = i18n[lang]["event-label"];
                    document.getElementById('fact').innerText = `${label} (${event.year}) ${event.text}`;
                }
            } catch (e) {
                document.getElementById('fact').innerText = "Bilgi şu an Wikipedia'dan alınamıyor.";
            }
        }

        // --- ANALOG SAAT KURULUMU ---
        const clockElem = document.getElementById('analog');
        function initClockUI() {
            for(let i=0; i<60; i++) {
                const mark = document.createElement('div');
                mark.className = (i % 5 === 0) ? 'mark mark-large' : 'mark';
                mark.style.transform = `rotate(${i * 6}deg)`; 
                clockElem.appendChild(mark);
            }
            for(let i=1; i<=12; i++) {
                const num = document.createElement('div');
                num.className = 'clock-number';
                const angle = (i * 30) * (Math.PI / 180);
                const r = 120;
                const x = 160 + r * Math.sin(angle);
                const y = 160 - r * Math.cos(angle);
                num.style.left = `${x}px`;
                num.style.top = `${y}px`;
                num.innerText = i;
                clockElem.appendChild(num);
            }
        }

        function updateMain() {
            const now = new Date();
            const utc = now.getTime() + (now.getTimezoneOffset() * 60000);
            const t = new Date(utc + (mainOffset * 3600000));

            document.getElementById('h-hand').style.transform = `translateX(-50%) rotate(${(t.getHours() * 30) + (t.getMinutes() / 2)}deg)`;
            document.getElementById('m-hand').style.transform = `translateX(-50%) rotate(${t.getMinutes() * 6}deg)`;
            document.getElementById('s-hand').style.transform = `translateX(-50%) rotate(${t.getSeconds() * 6}deg)`;

            const timeStr = t.toLocaleTimeString('tr-TR', {hour12:false});
            document.getElementById('d-time').innerText = timeStr;
            
            // TITLE FIX - Canlı saati sekmeye yazdır
            document.title = timeStr; 
            
            let weekNum = 1;
            if (t.getFullYear() === 2026 && t.getMonth() === 0) {
                if(t.getDate() >= 1 && t.getDate() <= 7) weekNum = 2;
                else weekNum = Math.ceil(t.getDate() / 7) + 1;
            }

            const localeStr = lang === 'tr' ? 'tr-TR' : (lang === 'de' ? 'de-DE' : 'en-US');
            const dateLong = t.toLocaleDateString(localeStr, {day:'numeric', month:'long', year:'numeric', weekday:'long'});
            document.getElementById('full-date').innerText = `${dateLong}, ${weekNum}. ${i18n[lang].week}`;
        }

        function changeLang(l) {
            lang = l;
            document.querySelectorAll('[data-key]').forEach(el => {
                const key = el.getAttribute('data-key');
                if (i18n[lang][key]) el.innerText = i18n[lang][key];
            });
            updateMain();
            fetchDailyFact();
        }

        function showTab(el, id) {
            document.querySelectorAll('.nav-item').forEach(i => i.classList.remove('active'));
            document.querySelectorAll('.content-section').forEach(s => s.classList.remove('active'));
            el.classList.add('active'); 
            document.getElementById(id).classList.add('active');
        }

        function getNextDate(month, day) {
            let now = new Date();
            let d = new Date(now.getFullYear(), month, day);
            if (d < now) d.setFullYear(now.getFullYear() + 1);
            return d;
        }

        function getNextEid() {
            let now = new Date();
            for (let dateStr of eidDates) {
                let d = new Date(dateStr);
                if (d > now) return d;
            }
            return new Date(eidDates[eidDates.length-1]);
        }

        function runCountdowns() {
            document.querySelectorAll('.cd-sec').forEach(s => {
                let target;
                let title = s.querySelector('h1');
                
                if (s.dataset.type === "yearly") {
                    target = getNextDate(parseInt(s.dataset.month), parseInt(s.dataset.day));
                    let baseLabel = (s.id === 'newyear-sec') ? i18n[lang]["menu-newyear"] : 'Halloween';
                    title.innerText = `${baseLabel} ${target.getFullYear()}`;
                } else if (s.dataset.type === "eid") {
                    target = getNextEid();
                    title.innerText = `${i18n[lang]["menu-eid"]} ${target.getFullYear()}`;
                } else {
                    target = new Date(s.dataset.date);
                }

                const diff = target - new Date();
                const grid = s.querySelector('.timer-grid');
                if (!grid) return;
                
                if(diff > 0) {
                    const data = {
                        "GÜN": Math.floor(diff/86400000), 
                        "SAAT": Math.floor((diff%86400000)/3600000), 
                        "DAK": Math.floor((diff%3600000)/60000), 
                        "SN": Math.floor((diff%60000)/1000)
                    };
                    grid.innerHTML = Object.entries(data).map(([k,v]) => `<div class="unit-card"><span class="u-val">${v}</span><span class="u-lab">${k}</span></div>`).join('');
                } else {
                    grid.innerHTML = "<h2 style='color:var(--accent-green)'>ZAMAN GELDİ!</h2>";
                }
            });
        }

        function renderCities() {
            const grid = document.getElementById('world-grid');
            if (!grid) return;
            grid.innerHTML = cities.map(c => {
                const now = new Date();
                const utc = now.getTime() + (now.getTimezoneOffset() * 60000);
                const ct = new Date(utc + (c.o * 3600000));
                return `<div class="city-card" onclick="setMain('${c.n}', ${c.o})">
                    <b>${c.n}</b><br>
                    <span style="font-size:1.6rem; color:var(--accent-blue); font-family:monospace; font-weight:bold">
                        ${ct.getHours().toString().padStart(2,'0')}:${ct.getMinutes().toString().padStart(2,'0')}
                    </span>
                </div>`;
            }).join('');
        }
        function setMain(name, off) { mainZone = name; mainOffset = off; document.querySelector('.nav-item').click(); }

        let chS, chE = 0, chR = false, chI;
        function toggleChrono() {
            const b = document.getElementById('ch-toggle');
            if(!chR) {
                chS = Date.now() - chE;
                chI = setInterval(() => {
                    chE = Date.now() - chS;
                    const h = Math.floor((chE/3600000)%24), m = Math.floor((chE/60000)%60), s = Math.floor((chE/1000)%60), ms = Math.floor((chE%1000)/10);
                    document.getElementById('ch-disp').innerText = `${h.toString().padStart(2,'0')}:${m.toString().padStart(2,'0')}:${s.toString().padStart(2,'0')}:${ms.toString().padStart(2,'0')}`;
                }, 10);
                b.innerText = i18n[lang]["btn-stop"]; b.className = "btn btn-red"; chR = true;
            } else { clearInterval(chI); b.innerText = i18n[lang]["btn-start"]; b.className = "btn btn-green"; chR = false; }
        }
        function resetChrono() { clearInterval(chI); chE = 0; chR = false; document.getElementById('ch-disp').innerText = "00:00:00:00"; document.getElementById('ch-toggle').innerText = i18n[lang]["btn-start"]; document.getElementById('ch-toggle').className="btn btn-green"; }

        let tmS, tmE = 0, tmR = false, tmI;
        function toggleTimer() {
            const b = document.getElementById('tm-toggle');
            if(!tmR) {
                if(tmE <= 0) {
                    tmE = (Number(document.getElementById('tm-d').value)*86400000) + (Number(document.getElementById('tm-h').value)*3600000) + (Number(document.getElementById('tm-m').value)*60000) + (Number(document.getElementById('tm-s').value)*1000);
                }
                if(tmE <= 0) return;
                document.getElementById('tm-fields').style.display = 'none'; document.getElementById('tm-disp').style.display = 'block';
                tmS = Date.now();
                tmI = setInterval(() => {
                    let rem = tmE - (Date.now() - tmS);
                    if(rem <= 0) { rem = 0; document.body.style.backgroundColor = "#500"; clearInterval(tmI); }
                    const d = Math.floor(rem/86400000), h = Math.floor((rem/3600000)%24), m = Math.floor((rem/60000)%60), s = Math.floor((rem/1000)%60);
                    document.getElementById('tm-disp').innerText = `${d}:${h.toString().padStart(2,'0')}:${m.toString().padStart(2,'0')}:${s.toString().padStart(2,'0')}`;
                }, 100);
                b.innerText = i18n[lang]["btn-stop"]; b.className = "btn btn-red"; tmR = true;
            } else { tmE -= (Date.now() - tmS); clearInterval(tmI); b.innerText = i18n[lang]["btn-start"]; b.className = "btn btn-green"; tmR = false; }
        }
        function resetTimer() { clearInterval(tmI); tmE = 0; tmR = false; document.body.style.backgroundColor = "var(--bg-dark)"; document.getElementById('tm-fields').style.display = 'flex'; document.getElementById('tm-disp').style.display = 'none'; document.getElementById('tm-toggle').innerText = i18n[lang]["btn-start"]; document.getElementById('tm-toggle').className="btn btn-green"; }

        let ageI;
        function startAge() {
            const birth = new Date(document.getElementById('birth-input').value);
            if(isNaN(birth)) return;
            document.getElementById('age-res').style.display = "flex";
            if(ageI) clearInterval(ageI);
            ageI = setInterval(() => {
                const diff = new Date() - birth;
                const data = {"YIL": Math.floor(diff/31536000000), "GÜN": Math.floor(diff/86400000), "SAAT": Math.floor(diff/3600000), "DAK": Math.floor(diff/60000), "SN": Math.floor(diff/1000)};
                document.getElementById('age-res').innerHTML = Object.entries(data).map(([k,v]) => `<div class="unit-card"><span class="u-val" style="font-size:1.3rem">${v.toLocaleString()}</span><span class="u-lab">${k}</span></div>`).join('');
            }, 1000);
        }

        function calcD() {
            const d1 = new Date(document.getElementById('d1').value), d2 = new Date(document.getElementById('d2').value);
            if(isNaN(d1) || isNaN(d2)) return;
            document.getElementById('diff-res').style.display = "block";
            document.getElementById('diff-res').innerHTML = `Aradaki fark tam <b>${Math.floor(Math.abs(d2 - d1)/86400000).toLocaleString()}</b> gün.`;
        }

        function filterCities() {
            const val = document.getElementById('city-search').value.toLowerCase();
            document.querySelectorAll('.city-card').forEach(card => card.style.display = card.innerText.toLowerCase().includes(val) ? 'block' : 'none');
        }

        window.onload = () => {
            initClockUI();
            renderCities();
            setInterval(updateMain, 1000);
            setInterval(runCountdowns, 1000);
            fetchDailyFact();
            changeLang('tr');
        };
    </script>
</body>
</html>